<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<code>geom_stepribbon</code> â€¢ RcmdrPlugin.BioStat</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
	<link rel="icon" href="../favicon.png" />
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">RcmdrPlugin.BioStat | R package</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Turorials and Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/extrafont.html">Extend with the `extrafont` package</a>
    </li>
    <li>
      <a href="../articles/geom-stepribbon.html">`geom_stepribbon`</a>
    </li>
    <li>
      <a href="../articles/plot-km-requirement.html">Dataset requirements to make Kaplan-Meier plot with RcmdrPlugin.KMggplot2</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GegznaV/RcmdrPlugin.BioStat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1><code>geom_stepribbon</code></h1>
                        <h4 class="author">Triad sou.</h4>
            
            <h4 class="date">2015-12-31</h4>
          </div>

    
    
<div class="contents">
<p>The <code>geom_stepribbon</code> is an extension of the <code>geom_ribbon</code>, and is optimized for Kaplan-Meier plots with pointwise confidence intervals or a confidence band.</p>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/geom_stepribbon.html">geom_stepribbon</a></span>(<span class="dt">mapping =</span> <span class="ot">NULL</span>, <span class="dt">data =</span> <span class="ot">NULL</span>, <span class="dt">stat =</span> <span class="st">"identity"</span>,
  <span class="dt">position =</span> <span class="st">"identity"</span>, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">show.legend =</span> <span class="ot">NA</span>,
  <span class="dt">inherit.aes =</span> <span class="ot">TRUE</span>, <span class="dt">kmplot =</span> <span class="ot">FALSE</span>, ...)</code></pre></div>
</div>
<div id="the-additional-argument" class="section level2">
<h2 class="hasAnchor">
<a href="#the-additional-argument" class="anchor"></a>The additional argument</h2>
<ul>
<li>
<code>kmplot</code>
<ul>
<li>If <code>TRUE</code>, missing values are replaced by the previous values. This option is needed to make Kaplan-Meier plots if the last observation has an event, in which case the upper and lower values of the last observation are missing. This processing is optimized for results from the <code>survfit</code> function.</li>
</ul>
</li>
</ul>
<p>Other arguments are the same as the <code>geom_ribbon</code>.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">huron &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">year =</span> <span class="dv">1875</span>:<span class="dv">1972</span>, <span class="dt">level =</span> <span class="kw">as.vector</span>(LakeHuron))
h &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(huron, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(year))
h +<span class="st"> </span>RcmdrPlugin.KMggplot2::<span class="kw"><a href="../reference/geom_stepribbon.html">geom_stepribbon</a></span>(
      <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin =</span> level -<span class="st"> </span><span class="dv">1</span>, <span class="dt">ymax =</span> level +<span class="st"> </span><span class="dv">1</span>),
      <span class="dt">fill =</span> <span class="st">"grey70"</span>
    ) +
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_step</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">y =</span> level))</code></pre></div>
<p><img src="geom-stepribbon_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(
      <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin =</span> level -<span class="st"> </span><span class="dv">1</span>, <span class="dt">ymax =</span> level +<span class="st"> </span><span class="dv">1</span>),
      <span class="dt">fill =</span> <span class="st">"grey70"</span>
    ) +
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">y =</span> level))</code></pre></div>
<p><img src="geom-stepribbon_files/figure-html/unnamed-chunk-1-2.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(dataKm, <span class="dt">package =</span> <span class="st">"RcmdrPlugin.KMggplot2"</span>)

.df &lt;-<span class="st"> </span><span class="kw">na.omit</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> dataKm$time, <span class="dt">y =</span> dataKm$event, <span class="dt">z =</span> dataKm$trt))
.df &lt;-<span class="st"> </span>.df[<span class="kw">do.call</span>(order, .df[, <span class="kw">c</span>(<span class="st">"z"</span>, <span class="st">"x"</span>), <span class="dt">drop =</span> <span class="ot">FALSE</span>]), , drop =<span class="st"> </span><span class="ot">FALSE</span>]
.fit &lt;-<span class="st"> </span>survival::<span class="kw">survfit</span>(
  survival::<span class="kw">Surv</span>(<span class="dt">time =</span> x, <span class="dt">event =</span> y, <span class="dt">type =</span> <span class="st">"right"</span>) ~<span class="st"> </span>z, .df)
.fit &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> .fit$time, <span class="dt">y =</span> .fit$surv, <span class="dt">nrisk =</span> .fit$n.risk, 
  <span class="dt">nevent =</span> .fit$n.event, <span class="dt">ncensor=</span> .fit$n.censor, <span class="dt">upper =</span> .fit$upper,
  <span class="dt">lower =</span> .fit$lower)
.df &lt;-<span class="st"> </span>.df[!<span class="kw">duplicated</span>(.df[,<span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"z"</span>)]), ]
.df &lt;-<span class="st"> </span>.fit &lt;-<span class="st"> </span><span class="kw">data.frame</span>(.fit, .df[, <span class="kw">c</span>(<span class="st">"z"</span>), <span class="dt">drop =</span> <span class="ot">FALSE</span>])
.df &lt;-<span class="st"> </span>.fit &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">unique</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">1</span>, <span class="dt">nrisk =</span> <span class="ot">NA</span>, <span class="dt">nevent =</span> <span class="ot">NA</span>,
  <span class="dt">ncensor =</span> <span class="ot">NA</span>, <span class="dt">upper =</span> <span class="dv">1</span>, <span class="dt">lower =</span> <span class="dv">1</span>, .df[, <span class="kw">c</span>(<span class="st">"z"</span>), <span class="dt">drop =</span> <span class="ot">FALSE</span>])), .fit)
.cens &lt;-<span class="st"> </span><span class="kw">subset</span>(.fit, ncensor ==<span class="st"> </span><span class="dv">1</span>)

<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="dt">data =</span> .fit, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">colour =</span> z)) +<span class="st"> </span>
<span class="st">  </span>RcmdrPlugin.KMggplot2::<span class="kw"><a href="../reference/geom_stepribbon.html">geom_stepribbon</a></span>(<span class="dt">data =</span> .fit,
    <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper, <span class="dt">fill =</span> z), <span class="dt">alpha =</span> <span class="fl">0.25</span>,
    <span class="dt">colour =</span> <span class="st">"transparent"</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>, <span class="dt">kmplot =</span> <span class="ot">TRUE</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_step</a></span>(<span class="dt">size =</span> <span class="fl">1.5</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_linerange">geom_linerange</a></span>(<span class="dt">data =</span> .cens, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> y, <span class="dt">ymax =</span> y +<span class="st"> </span><span class="fl">0.02</span>),
    <span class="dt">size =</span> <span class="fl">1.5</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_x_continuous</a></span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">21</span>, <span class="dt">by =</span> <span class="dv">7</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">21</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_continuous">scale_y_continuous</a></span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">expand =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="dv">0</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_brewer">scale_colour_brewer</a></span>(<span class="dt">palette =</span> <span class="st">"Set1"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_brewer">scale_fill_brewer</a></span>(<span class="dt">palette =</span> <span class="st">"Set1"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Time from entry"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Proportion of survival"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">colour =</span> <span class="st">"trt"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size =</span> <span class="dv">14</span>, <span class="dt">base_family =</span> <span class="st">"sans"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)</code></pre></div>
<p><img src="geom-stepribbon_files/figure-html/unnamed-chunk-1-3.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#usage">Usage</a></li>
      <li><a href="#the-additional-argument">The additional argument</a></li>
      <li><a href="#example">Example</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Triad Sou, Kengo NAGASHIMA.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
