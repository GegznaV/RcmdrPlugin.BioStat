#' @name TclTk-helper-functions
#' @title Helper functions for Tcl/Tk.
#' @keywords internal
NULL


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
# Label for R Commander
# see also: labelRcmdr
bs_label_b <- function(..., fg = Rcmdr::getRcmdr("title.color")) {
  bs_label(..., fg = fg)
}

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
# Label for R Commander
# see also: labelRcmdr
bs_label <- function(..., fg = NULL) {
  if (is.null(fg)) tk2label(...) else tk2label(..., foreground = fg)
}

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
labeled_frame <- function(parent, label = NULL, ...) {
  # TODO: needs review
  ttklabelframe(parent = parent,
                labelwidget = tklabel(
                  parent,
                  text = label,
                  font = "RcmdrTitleFont",
                  foreground = Rcmdr::getRcmdr("title.color"),
                  ...)
  )
}

#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
tk_title <- function(parent = top, text = "", pady = c(5, 9),
                     font = tkfont.create(weight = "bold", size = 9),
                     fg = Rcmdr::getRcmdr("title.color"),
                     ...) {
  tkgrid(
    bs_label(
      parent,
      text = gettext_bs(text),
      font = font,
      fg = fg),
    pady = pady,
    ...)
}

# Commands -------------------------------------------------------------------
#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
tcl_get_parent <- function(obj) {

  obj$env$parent
  # tkwinfo("parent", obj)
}

# Commands -------------------------------------------------------------------
#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
tcl_get_children_id <- function(obj) {
    tkwinfo("children", obj) %>% as.character()
    # tkwinfo("children", obj) %>% tclvalue() %>% tcl_str_split()
}

tcl_str_split <- function(str) {
  str_split(str, " ")[[1]]
}


# Commands -------------------------------------------------------------------
#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
tcl_get_siblings_id <- function(obj) {
  tkwinfo("parent", obj) %>%
    tkwinfo("children", .) %>%
    as.character()

  # tkwinfo("parent", obj) %>%
  #   tkwinfo("children", .) %>%
  #   tclvalue() %>%
  #   str_split(" ") %>%
  #   .[[1]]

}

#' @rdname TclTk-helper-functions
#' @export
#' @keywords internal
tcl_get_rcmdr_obj <- function(id, main_win = CommanderWindow()) {
  # id -- Tcl/Tk object ID as string, e.g. ".1", ".1.24", ".1.35.4"
  # main Tcl/Tk window (Tcl/Tk object)
  to_widget <-
    stringr::str_split(id, "\\.") %>%
    .[[1]] %>%
    purrr::accumulate(str_c, sep = ".") %>%
    .[-1] %>%
    safe_names() %>%
    stringr::str_c(collapse = "$env$")

  str_glue_eval("main_win$env$parent$env${to_widget}")

}

